<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>support &mdash; MTE 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e031e9a9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../index.html">
            
              <img src="../_static/Logo2r2.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../governing_equations.html">Governing equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../computational_approach.html">Computational approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flanksim.html">Synthetic topopography: flank simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../etna.html">Case study: Mount Etna</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app1.html">Complete derivation of the equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app2.html">Coordinate systems of different components</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MTE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">support</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for support</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span> 

<span class="c1">###################################################################################################</span>
<span class="c1"># this function adds reference field to measurements and computes Pmag Int,Inc,Dec</span>

<div class="viewcode-block" id="add_referencefield"><a class="viewcode-back" href="../functions.html#support.add_referencefield">[docs]</a><span class="k">def</span> <span class="nf">add_referencefield</span><span class="p">(</span><span class="n">B0_name</span><span class="p">,</span><span class="n">npath</span><span class="p">,</span><span class="n">dmeas</span><span class="p">,</span><span class="n">B0</span><span class="p">,</span><span class="n">B_si</span><span class="p">,</span><span class="n">benchmark</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns total computed magnetic field, intensity, inclination and declination</span>
<span class="sd">    at all points on a path by </span>
<span class="sd">  </span>
<span class="sd">    1. rotating vector from model to Paleomagnetism coordinate system.</span>
<span class="sd">    2. adding a (global) reference field B0.</span>
<span class="sd">    3. computing standard PMAG equations :cite:`TAUXE`.</span>
<span class="sd">  </span>
<span class="sd">    Next, it writes individual(x,y,z) components of total magnetic field and intensity,</span>
<span class="sd">    inclination and declination into file named: ``measurements_path_refField{BO_name}.ascii``.</span>
<span class="sd">   </span>
<span class="sd">    :param B0_name: name of reference field (used in writing file).</span>
<span class="sd">    :type B0_name: str </span>
<span class="sd">    :param npath: amount of points on path.</span>
<span class="sd">    :type npath: scalar(int)</span>
<span class="sd">    :param dmeas: 1D array(npath) containing distance between two points of the path (from meyer), used for plotting.</span>
<span class="sd">    :type dmeas: array_like(float)</span>
<span class="sd">    :param B0: 1D array(3) containing 3 components (0=x;1=y;2=z), components of reference field to be added.</span>
<span class="sd">    :type B0: array_like(float)</span>
<span class="sd">    :param B_si: 2D array(3,npath), containing components (0=x;1=y;2=z,npath) of the computed magnetic field due to the underlying magnetized matter (anomalous field) at each point of the path.</span>
<span class="sd">    :type B_si: array_like(float)</span>
<span class="sd">    :param benchmark: number associated with benchmark, see :doc:`benchmarks`.</span>
<span class="sd">    :type benchmark: str </span>
<span class="sd">    :return: </span>
<span class="sd">        - **B_siB0** *(array_like(float))* - 2D array(3,npath), containing components (0=x;1=y;2=z,npath) of the total magnetic field (anomalous + reference field) at each point of the path.</span>
<span class="sd">        - **In_siB0** *(array_like(float))* - 1D array(npath), containing intensity of the total magnetic field (anomalous + reference field) at each point of the path.</span>
<span class="sd">        - **Ic_siB0** *(array_like(float))* - 1D array(npath), containing inclination of the total magnetic field (anomalous + reference field) at each point of the path.</span>
<span class="sd">        - **Dc_siB0** *(array_like(float))* - 1D array(npath), containing declination of total magnetic field (anomalous + reference field) at each point of the path.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">linefile1</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;measurements_path_refField</span><span class="si">{</span><span class="n">B0_name</span><span class="si">}</span><span class="s2">.ascii&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">linefile1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# 1    , 2      , 3      , 4      , 5      , 6      , 7       </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">linefile1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;# dmeas, Bx_siB0, By_siB0, Bz_siB0, In_siB0, Ic_siB0, Dc_siB0 </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">B_siB0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="n">npath</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">In_siB0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npath</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">Ic_siB0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npath</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">Dc_siB0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">npath</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">npath</span><span class="p">):</span>      
        <span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">B_si</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">B0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#adding B0 in pmag coor + B_si in model coor</span>
        <span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">B_si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">B0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">B_siB0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=-</span><span class="n">B_si</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">B0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">In_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Ic_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span>
        <span class="n">Dc_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">180</span>
   
        <span class="k">if</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;4&#39;</span><span class="p">:</span>
           <span class="n">linefile1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">B_siB0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>\
                                                    <span class="n">In_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Ic_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Dc_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>    
        <span class="k">else</span><span class="p">:</span>         
           <span class="n">linefile1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">dmeas</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>\
                                                       <span class="n">B_siB0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">B_siB0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">B_siB0</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>\
                                                      <span class="n">In_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Ic_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Dc_siB0</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>            
    <span class="k">return</span> <span class="n">B_siB0</span><span class="p">,</span><span class="n">In_siB0</span><span class="p">,</span><span class="n">Ic_siB0</span><span class="p">,</span><span class="n">Dc_siB0</span></div>

<span class="c1">###################################################################################################</span>
<span class="c1"># this function returns a topography value at each point x,y passed as argument</span>

<div class="viewcode-block" id="topography"><a class="viewcode-back" href="../functions.html#support.topography">[docs]</a><span class="k">def</span> <span class="nf">topography</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">llambda</span><span class="p">,</span><span class="n">cos_dir</span><span class="p">,</span><span class="n">sin_dir</span><span class="p">,</span><span class="n">slopex</span><span class="p">,</span><span class="n">slopey</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns topography (height) value at each point defined by x,y coordinates passed.   </span>
<span class="sd">    </span>
<span class="sd">    :param x: x coordinate of computation point.</span>
<span class="sd">    :type x: scalar(float) </span>
<span class="sd">    :param y: y coordinate of computation point.</span>
<span class="sd">    :type y: scalar(float) </span>
<span class="sd">    :param A: amplitude of sine function used to approximate wavy topography of ridges and gullies.</span>
<span class="sd">    :type A: scalar(float)</span>
<span class="sd">    :param llambda: wavelength of sine function used to approximate wavy topography of ridges and gullies.</span>
<span class="sd">    :type llambda: scalar(float)</span>
<span class="sd">    :param cos_dir: cosine of ``direction``, that defines the direction of the wave function along the surface (default = perpendicular to slope). </span>
<span class="sd">    :type cos_dir: scalar(float)</span>
<span class="sd">    :param sin_dir: sine of ``direction``, that defines the direction of the wave function along the surface (default = perpendicular to slope).</span>
<span class="sd">    :type sin_dir: scalar(float)</span>
<span class="sd">    :param slopex: the tangent of the angle (in rad) of the surface that defines the slope in x direction for each respective side.</span>
<span class="sd">    :type slopex: scalar(float)</span>
<span class="sd">    :param slopey: the tangent of the angle (in rad) of the surface that defines the slope in y direction for each respective side. </span>
<span class="sd">    :type slopey: scalar(float)</span>

<span class="sd">    :return: </span>
<span class="sd">        - **h_fs** *(scalar(float))* - the height value for the point passed to function for the respective position on the flank (chosen by ``subbench``).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">llambda</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">pert1</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pert1</span><span class="o">=</span><span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">llambda</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">cos_dir</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">sin_dir</span><span class="p">))</span>
    <span class="n">pert2</span><span class="o">=</span><span class="n">slopex</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">slopey</span><span class="o">*</span><span class="n">y</span> 
    <span class="k">return</span> <span class="n">pert1</span><span class="o">+</span><span class="n">pert2</span></div>

<span class="c1">###################################################################################################</span>
<span class="c1"># returns analytical solution (vector B) </span>

<div class="viewcode-block" id="compute_analytical_solution"><a class="viewcode-back" href="../functions.html#support.compute_analytical_solution">[docs]</a><span class="k">def</span> <span class="nf">compute_analytical_solution</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">Mx</span><span class="p">,</span><span class="n">My</span><span class="p">,</span><span class="n">Mz</span><span class="p">,</span><span class="n">xcenter</span><span class="p">,</span><span class="n">ycenter</span><span class="p">,</span><span class="n">zcenter</span><span class="p">,</span><span class="n">benchmark</span><span class="p">):</span>
<span class="w">   </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Returns analytical solution, see :doc:`benchmarks`, of the components of the magnetic field for each benchmark.</span>

<span class="sd">   :param x: 1D array(npath) containing x coordinate of each computation point.</span>
<span class="sd">   :type x: array_like(float)    </span>
<span class="sd">   :param y: 1D array(npath) containing y coordinate of each computation point.</span>
<span class="sd">   :type y: array_like(float)    </span>
<span class="sd">   :param z: 1D array(npath) containing z coordinate of each computation point.</span>
<span class="sd">   :type z: array_like(float)</span>
<span class="sd">   :param R: radius of the sphere (if applicable)</span>
<span class="sd">   :type R: scalar(float)</span>
<span class="sd">   :param Mx: x component magnetization of magnetized body (constant).</span>
<span class="sd">   :type Mx: scalar(float)</span>
<span class="sd">   :param My: y component magnetization of magnetized body (constant).</span>
<span class="sd">   :type My: scalar(float)</span>
<span class="sd">   :param Mz: z component magnetization of magnetized body (constant).</span>
<span class="sd">   :type Mz: scalar(float) </span>
<span class="sd">   :param xcenter: x coordinate of center of the sphere.</span>
<span class="sd">   :type xcenter: scalar(float) </span>
<span class="sd">   :param ycenter: y coordinate of center of the sphere.</span>
<span class="sd">   :type ycenter: scalar(float) </span>
<span class="sd">   :param zcenter: z coordinate of center of the sphere.</span>
<span class="sd">   :type zcenter: scalar(float) </span>
<span class="sd">   :param benchmark: number associated with benchmark, see :doc:`benchmarks`.</span>
<span class="sd">   :type benchmark: str</span>

<span class="sd">   :return: </span>
<span class="sd">        - **h_fs** *(array_like(float))* - 2D array(3,npath) containing components (0=x;1=y;2=z) produced by the analytical solution for the magnetic field for chosen benchmark (and model setup) and each point.</span>

<span class="sd">   &quot;&quot;&quot;</span>
   
   <span class="c1">#-----------------------------------------------------------------</span>
   <span class="k">if</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span> 
      <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span><span class="mf">1e-7</span>
      <span class="n">V</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">R</span><span class="o">**</span><span class="mi">3</span>
      <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xcenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">ycenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">zcenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
      <span class="c1">#M aligned with Z-axis</span>
      <span class="n">Bx</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">By</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">Bz</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">r</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Mz</span>
   <span class="c1">#-----------------------------------------------------------------</span>
   <span class="k">if</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;2a&#39;</span> <span class="ow">or</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;2b&#39;</span> <span class="ow">or</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;5&#39;</span><span class="p">:</span>
      <span class="n">Bx</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">By</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">Bz</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="c1">#-----------------------------------------------------------------</span>
   <span class="k">if</span> <span class="n">benchmark</span><span class="o">==</span><span class="s1">&#39;3&#39;</span><span class="p">:</span> 
      <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xcenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">ycenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">zcenter</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
      <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">z</span> <span class="o">-</span> <span class="n">zcenter</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
      <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">ycenter</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xcenter</span><span class="p">))</span>
      <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
      <span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span>
      <span class="n">rux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
      <span class="n">ruy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
      <span class="n">ruz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="n">thux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
      <span class="n">thuy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
      <span class="n">thuz</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="n">Bx</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">thux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
      <span class="n">By</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ruy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">thuy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
      <span class="n">Bz</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">Mz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">ruz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">thuz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Bx</span><span class="p">,</span><span class="n">By</span><span class="p">,</span><span class="n">Bz</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></div>
<span class="c1"># returns analytical solution (vector B) </span>


<div class="viewcode-block" id="is_point_near_diagonal"><a class="viewcode-back" href="../functions.html#support.is_point_near_diagonal">[docs]</a><span class="k">def</span> <span class="nf">is_point_near_diagonal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">eps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | This function checks if a point (x, y) is near to either of the two diagonals of a rectangle with sides of length Lx and Ly. </span>
<span class="sd">    | Distance units are irrelevant but must be consistent. </span>
<span class="sd">    </span>
<span class="sd">    :param x: x-coordinate of the observation point.</span>
<span class="sd">    :type x: scalar(float)</span>
<span class="sd">    :param y: y-coordinate of the observation point.</span>
<span class="sd">    :type y: scalar(float)</span>
<span class="sd">    :param Lx: length of the edge of a rectangle along the x-axis.</span>
<span class="sd">    :type Lx: scalar(float)</span>
<span class="sd">    :param Ly: length of the edge of a rectangle along the y-axis.</span>
<span class="sd">    :type Ly: scalar(float)</span>
<span class="sd">    :param eps: tolerance value for proximity check.</span>
<span class="sd">    :type eps: scalar(float)</span>
<span class="sd">  </span>
<span class="sd">    :return: </span>
<span class="sd">        - **bool** *(bool)* - True if (x, y) is near (&lt;eps) to either diagonal, False otherwise.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Slopes of the two diagonals</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ly</span> <span class="o">/</span> <span class="n">Lx</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">Ly</span> <span class="o">/</span> <span class="n">Lx</span>

    <span class="c1"># Constants for line equations of the form Ax + By + C = 0</span>
    <span class="c1"># For the two diagonals:</span>
    <span class="c1"># y = m1 * x becomes: -m1*x + y = 0 =&gt; A1=-m1, B1=1, C1=0</span>
    <span class="c1"># y = m2 * x becomes: -m2*x + y = 0 =&gt; A2=-m2, B2=1, C2=0</span>
    
    <span class="n">A1</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">C1</span> <span class="o">=</span> <span class="o">-</span><span class="n">m1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">A2</span><span class="p">,</span> <span class="n">B2</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="o">-</span><span class="n">m2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    
    <span class="c1"># Calculating distances from point to both diagonals</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A1</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">B1</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">C1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">B1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">B2</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">C2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">A2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">B2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    
    <span class="c1"># Check if (x, y) is close to either diagonal</span>
    <span class="k">return</span> <span class="n">d1</span> <span class="o">&lt;</span> <span class="n">eps</span> <span class="ow">or</span> <span class="n">d2</span> <span class="o">&lt;</span> <span class="n">eps</span></div>



<div class="viewcode-block" id="shift_observation_points_edge"><a class="viewcode-back" href="../functions.html#support.shift_observation_points_edge">[docs]</a><span class="k">def</span> <span class="nf">shift_observation_points_edge</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="n">Ly</span><span class="p">,</span> <span class="n">nelx</span><span class="p">,</span> <span class="n">nely</span><span class="p">,</span> <span class="n">nelz</span><span class="p">,</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | The original subroutine of :cite:`BLAKELY`, was initially designed exclusively for use with the faces of a polyhedron. In contrast, our model s subdivides the top and bottom of the hexahedron elements into four triangles, see :func:`magnetostatics.compute_B_surface_integral_wtopo`. This introduces additional singularities, and thus spatial issues, if the observation point ``p`` lies on the diagonal of the top or bottom face of an element.</span>
<span class="sd">    | This function adjusts observation points positioned near the diagonal of additional triangles on the top (or bottom) of a hexahedron cell. </span>
<span class="sd">    | This function uses :func:`support.is_point_near_diagonal`, passing the length of an element in the x- and y-direction, and the x- and y- coordinates of each observation point with the x-coordinate and y-coordinate of each node on the top surface (see nnz-1) subtracted. This ensures testing of proximity to the diagonals of all elements. The function is designed to stop after first modification, as within macroscopic purposes we do not expect an observation point to be shifted to another diagonal. Afterwards, it states any modification within the &quot;message&quot;.</span>
<span class="sd">    | Both x- and y-coordinates are shifted using a random value between -1 and 1 times the artificial distance (factor).</span>
<span class="sd">    | This spatial problem isn&#39;t restricted to the domain bounds. While generating an artificial distance for singularities within the main calculation function (:func:`magnetostatics.facmag`) similar to the solution of :cite:`Bott63,BLAKELY` for edge alignment, would be preferred. The problem emerges from our decision to utilize the :func:`magnetostatics.facmag` in this particular manner (by subdividing the top and bottom into additional triangles). Since this setup is invoked via an external function, and because it falls outside the scope of the function’s original intention (to handle planes as polyhedron sides), we have opted to create this external function as well. Furthermore, there are several setups that do not require subdivision, and subsequently use the :func:`magnetostatics.compute_B_surface_integral_cuboid`, hence shifting there could only potentially introduce inaccuracies. This is avoided by the introduction of this function, only called for in case function :func:`magnetostatics.compute_B_surface_integral_wtopo` is employed, see :doc:`benchmarks`,:doc:`flanksim`,:doc:`etna`. </span>

<span class="sd">    | Benchmarks have established that the epsilon should be at least of a factor **1e-8** or larger. </span>

<span class="sd">    </span>
<span class="sd">    :param x: 1D array(NV) containing the x-coordinate of each domain nodes.</span>
<span class="sd">    :type x: array_like(float)</span>
<span class="sd">    :param y: 1D array(NV) containing the y-coordinate of each domain nodes.</span>
<span class="sd">    :type y: array_like(float)</span>
<span class="sd">    :param Lx: length of domain along the x-axis.</span>
<span class="sd">    :type Lx: scalar(float)</span>
<span class="sd">    :param Ly: length of domain along the y-axis.</span>
<span class="sd">    :type Ly: scalar(float)</span>
<span class="sd">    :param nelx: amount of elements (domain) in x-direction. </span>
<span class="sd">    :type nelx: scalar(int)</span>
<span class="sd">    :param nely: amount of elements (domain) in y-direction. </span>
<span class="sd">    :type nely: scalar(int)</span>
<span class="sd">    :param nelz: amount of elements (domain) in z-direction. </span>
<span class="sd">    :type nelz: scalar(int)</span>
<span class="sd">    :param xm: x-coordinate of the observation point.</span>
<span class="sd">    :type xm: scalar(float)</span>
<span class="sd">    :param ym: y-coordinate of the observation point.</span>
<span class="sd">    :type ym: scalar(float)</span>

<span class="sd">    :return:</span>
<span class="sd">        - **xm** *(scalar(float))* - adjusted x coordinate of the observation point.</span>
<span class="sd">        - **ym** *(scalar(float))* - adjusted x coordinate of the observation point.</span>

<span class="sd">        - **message** *(str))* - message indicating any adjustments made to the observation point.  </span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nnx</span><span class="p">,</span> <span class="n">nny</span><span class="p">,</span> <span class="n">nnz</span> <span class="o">=</span> <span class="n">nelx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nely</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nelz</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># number of nodes, x,y,z- direction</span>


    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;These observation points have been shifted:&quot;</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-5</span>  <span class="c1"># m</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nnx</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nnz</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="n">nnz</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># adjusting to check the last element </span>
                   <span class="k">if</span> <span class="n">is_point_near_diagonal</span><span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">counter</span><span class="p">],</span> <span class="n">ym</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">counter</span><span class="p">],</span> <span class="n">Lx</span><span class="o">/</span><span class="n">nelx</span><span class="p">,</span> <span class="n">Ly</span><span class="o">/</span><span class="n">nely</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span> <span class="ow">and</span> <span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;These observation points have been shifted:&quot;</span><span class="p">:</span>
                        <span class="n">xm</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">eps</span>
                        <span class="n">ym</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">eps</span>
                        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;x-coordinate was shifted by </span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2"> meters, due to diagonal alignment.&quot;</span>
                        <span class="k">break</span>  <span class="c1"># exiting the k loop if condition is met, if statement message prevents repeated testing. </span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># If message hasn&#39;t changed, no points were shifted</span>
    <span class="k">if</span> <span class="n">message</span><span class="o">==</span><span class="s2">&quot;These observation points have been shifted:&quot;</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;No observation points were shifted.&quot;</span>

    <span class="k">return</span> <span class="n">xm</span><span class="p">,</span> <span class="n">ym</span><span class="p">,</span> <span class="n">message</span></div>

<span class="k">def</span> <span class="nf">read_header</span><span class="p">(</span><span class="n">topo_file</span><span class="p">):</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">header_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ncols&#39;</span><span class="p">,</span> <span class="s1">&#39;nrows&#39;</span><span class="p">,</span> <span class="s1">&#39;xllcorner&#39;</span><span class="p">,</span> <span class="s1">&#39;yllcorner&#39;</span><span class="p">,</span> <span class="s1">&#39;cellsize&#39;</span><span class="p">,</span> <span class="s1">&#39;NODATA_value&#39;</span><span class="p">]</span>

    <span class="c1"># Create a backup of current file position to restore later</span>
    <span class="n">initial_position</span> <span class="o">=</span> <span class="n">topo_file</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
    <span class="c1"># Check if the first line contains &#39;ncols&#39;, indicative of a header</span>
    <span class="n">first_line</span> <span class="o">=</span> <span class="n">topo_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">topo_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>  <span class="c1"># Reset the file position</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first_line</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">first_line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ncols&#39;</span><span class="p">:</span>
        <span class="c1"># A header seems to be present. Proceed to read it.</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>  <span class="c1"># Assuming the header consists of 6 lines</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">topo_file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">header_keys</span><span class="p">:</span>
                <span class="n">header</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unexpected key. Reset file pointer and return</span>
                <span class="n">topo_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>

        <span class="c1"># If the header was read successfully, return</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">header</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">header_keys</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">header</span>

    <span class="c1"># If reached here, either no header was present or it was incomplete</span>
    <span class="n">topo_file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">initial_position</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Agnes.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<style type="text/css">
    .scrollToTop {
        text-align: center;
        font-weight: bold;
        position: fixed;
        bottom: 60px;
        right: 40px;
        display: none;
    }
</style>
<a href="#" class="scrollToTop">Scroll To Top</a>
<script type="text/javascript">
$(document).ready(function() {
    //Check to see if the window is top if not then display button
    $(window).scroll(function() {
        if ($(this).scrollTop() > 200) {
            $('.scrollToTop').fadeIn();
        } else {
            $('.scrollToTop').fadeOut();
        }
    });

    //Click event to scroll to top
    $('.scrollToTop').click(function() {
        $('html, body').animate({
            scrollTop: 0
        }, 500);
        return false;
    });
});
</script>
<style>
  /* Sidebar header (and topbar for mobile) */
  .wy-side-nav-search, .wy-nav-top {
    background: #3ae23a;
  }
  /* Sidebar */
  .wy-nav-side {
    background: #0c3303;
  }
</style>



</body>
</html>