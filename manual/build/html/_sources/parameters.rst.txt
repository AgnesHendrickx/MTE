.. _parameters:

Parameters
==========

| Replicating shapes in a discretized domain comes with inherent limitations that can potentially lead to inaccuracies in the computed values.
| Following :ref:`benchmarking <benchmarks>`, the next key step in the model validation process of any geodynamic model is to investigate the effect of model setup parameters and initial (boundary) conditions on the final results.
| For precise and optimal anomaly computations over varied topographies, it is crucial to initially establish certain domain parameters. These include identifying the minimum quantity of elements necessary for a accurate representation of volcanic terrain, and determining the minimal domain size to mitigate the impact of the edge effect.
| This edge effect, which occurs at the boundaries of the simulated domain, emerges from the cutoff at the outer boundary of the domain, generating its own unique magnetic anomaly. Our goal is to minimize the edge effect while also managing the absolute dimensions and resolution of the domain to ensure computational efficiency and reduce the time and effort required.
|
| These parameters were determined using a domain with synthetic topography, the southern flank setup as outlined in the section :ref:`flank simulations <flanksim>`. Furthermore, the test were repeated for zero topography solution (:ref:`benchmark 2a <B2>` without internal perturbation). The experiments were conducted along a path elevated 1 meter above the ground, representing the minimum elevation level for most field sites with observation points approximately 1 meter apart. Since the lowest elevation necessitates the largest resolutions and domain size, this setup will establish the threshold.
|
| It remains unclear whether the parameters defined through these tests can be directly correlated with the thresholds needed for calculations over topographies derived from a DEM. The real topographical variations on any volcano are anticipated to encompass larger and more intricate structures. Larger structures could potentially induce greater anomalies, which might extend farther, given that the magnitude of a magnetic anomaly generated by an entity is directly proportional to its physical properties (volume or weight) and is moderated by the distance, as noted in :cite:`GRIFFITHS`. Consequently, a reevaluation of these parameters will be essential in upcoming DEM examinations.
|
| Please note that the illustrations displayed here showcase only a fraction of the numerous tests executed to ascertain the necessary parameters and highlight significant discoveries.

Resolution
----------
| The resolution experiments will initiate at a high resolution, gradually reducing the number of elements. We anticipate identifying a threshold where any further reduction would lead to incorrect values. Understanding the manifestation of these errors is instrumental in identifying them in other intricate setups, particularly when using the Digital Elevation Model (DEM).
|
| All these tests maintained a consistent domain size of 50x50x120 meters for the synthetic topography setup. The expanded depth range was selected to minimize the interference from the bottom surface. To analyze this effect, some tests were conducted with a doubled domain depth of 240 meters, marked as "DD" configurations.
| Variations in the number of elements were explored in both the x and y directions, fluctuating within a range of 10 to 75 elements.
| It is expected that adjusting the number of elements in the depth dimension would not impact the outcome. As, theoretically, all internal forces should negate each other, meaning that increasing this quantity would only extend the computation time.
| The tests were repeated for the setup of a zero topography, however, we expect resolution variations to be redundant, as subdividing a flat surface into multiple surfaces yields no benefit, but rather will only increase computation time.
| Nonetheless, these hypotheses were examined through experiments.

Results
^^^^^^^
.. _restestcomp:
.. figure:: figures/restest_comp.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the resolution experiments. The initial domain size is 50x50x120 meter, ``DD`` relates to extended domain depth to 240 meter, the numbers in the key relate to the amount of elements in each direction. Please note, the y-axis varies between each subplot.

.. _restestzt:
.. figure:: figures/restest_zt_all.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the resolution experiments. The initial domain size is 250x250x20 meter, the numbers in the key relate to the amount of elements in each direction.

| :numref:`restestcomp` presents the findings of the resolution tests for the synthetic topography. As predicted by theory, the amount of elements in the z-direction does not affect the outcomes. For all subsequent tests, **the amount of elements in the z-direction will be maintained at 10**.
| In the xy-directions, allocating half an element per meter proves to be marginally adequate, with only minor deviations noted for the synthetic topography results. When the resolution is reduced further, a distinctive pattern emerges; the computed values first exhibit instability at the highest slope, indicated by abrupt fluctuations in what was previously a smooth progression. Future tests will aim to maintain a standard of **1.5 elements per meter in the spatial direction**, wherever feasible, while staying observant of these distinctive errors.
| Furthermore, :numref:`restestcomp` indicates that the depth extent of the domain does not alter the observed trends stemming from insufficient resolution, but instead generates a shift in the magnetic field strength.
| It should be noted that a curved surface is particularly hard to accurately represent with hexahedron elements, hence, another arbitrary shape might require much less resolution to produce adequate results.

Reproduce
^^^^^^^^^

.. collapse:: How to reproduce the results and figures for zero topography

   Please note basic setup in :ref:`installation`.
   To avoid redundancy, in this section we outline all setups side by side for each of tests done, rather than in separate steps as in :doc:`benchmarks`.

   1. In ``MTE.py``, modify benchmark attribution to ``2a``:

      .. code-block:: python
         :caption: /main/MTE.py
         :linenos:
         :lineno-start: 27
         :emphasize-lines: 1

         benchmark = '2a'

   2. Run setups & move files

      +--------------------------------------------------+--------------------------------------------------+--------------------------------------------------+--------------------------------------------------+
      |.. code-block:: python                            |.. code-block:: python                            |.. code-block:: python                            |.. code-block:: python                            |
      |   :caption: /main/MTE.py                         |   :caption: /main/MTE.py                         |   :caption: /main/MTE.py                         |   :caption: /main/MTE.py                         |
      |   :linenos:                                      |   :linenos:                                      |   :linenos:                                      |   :linenos:                                      |
      |   :lineno-start: 89                              |   :lineno-start: 89                              |   :lineno-start: 89                              |   :lineno-start: 89                              |
      |   :emphasize-lines: 2,3,4,5,6,7,8,9,10,12,14,15  |   :emphasize-lines: 5,6                          |   :emphasize-lines: 5,6                          |   :emphasize-lines: 5,6                          |
      |                                                  |                                                  |                                                  |                                                  |
      |   if benchmark == '2a':                          |   if benchmark == '2a':                          |   if benchmark == '2a':                          |   if benchmark == '2a':                          |
      |      Lx = 250                                    |      Lx = 250                                    |      Lx = 250                                    |      Lx = 250                                    |
      |      Ly = 250                                    |      Ly = 250                                    |      Ly = 250                                    |      Ly = 250                                    |
      |      Lz = 20                                     |      Lz = 20                                     |      Lz = 20                                     |      Lz = 20                                     |
      |      nelx = 25                                   |      nelx = 100                                  |      nelx = 200                                  |      nelx = 375                                  |
      |      nely = 25                                   |      nely = 100                                  |      nely = 200                                  |      nely = 375                                  |
      |      nelz = 10                                   |      nelz = 10                                   |      nelz = 10                                   |      nelz = 10                                   |
      |      Mx0 = 0                                     |      Mx0 = 0                                     |      Mx0 = 0                                     |      Mx0 = 0                                     |
      |      My0 = 4.085                                 |      My0 = 4.085                                 |      My0 = 4.085                                 |      My0 = 4.085                                 |
      |      Mz0 = -6.29                                 |      Mz0 = -6.29                                 |      Mz0 = -6.29                                 |      Mz0 = -6.29                                 |
      |      nqdim = 6                                   |      nqdim = 6                                   |      nqdim = 6                                   |      nqdim = 6                                   |
      |      dz = 0  # Base setup.                       |      dz = 0  # Base setup.                       |      dz = 0  # Base setup.                       |      dz = 0  # Base setup.                       |
      |      #dz = 0.1  # Amplitude random.              |      #dz = 0.1  # Amplitude random.              |      #dz = 0.1  # Amplitude random.              |      #dz = 0.1  # Amplitude random.              |
      |      do_plane_measurements = False               |      do_plane_measurements = False               |      do_plane_measurements = False               |      do_plane_measurements = False               |
      |      do_line_measurements = True                 |      do_line_measurements = True                 |      do_line_measurements = True                 |      do_line_measurements = True                 |
      +--------------------------------------------------+--------------------------------------------------+--------------------------------------------------+--------------------------------------------------+

      .. code-block::
            :caption: /main/

            python3 -u MTE.py | tee log.txt

      +-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+
      |.. code-block::                                                                                |.. code-block::                                                                                |.. code-block::                                                                                |.. code-block::                                                                                |
      |   :caption: /main/                                                                            |   :caption: /main/                                                                            |   :caption: /main/                                                                            |   :caption: /main/                                                                            |
      |                                                                                               |                                                                                               |                                                                                               |                                                                                               |
      |   mkdir zero_topo/restest/25_25_10 && mv log.txt *.vtu *.ascii zero_topo/restest/25_25_10     |   mkdir zero_topo/restest/100_100_10 && mv log.txt *.vtu *.ascii zero_topo/restest/100_100_10 |   mkdir zero_topo/restest/200_200_10 && mv log.txt *.vtu *.ascii zero_topo/restest/200_200_10 |   mkdir zero_topo/restest/375_375_10 && mv log.txt *.vtu *.ascii zero_topo/restest/375_375_10 |
      +-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------+


   3. Go to directory & plot to visualize

      .. code-block::
         :caption: /main/

         cd zero_topo/

      +---------------------------------------------+----------------------------------------------+
      |.. code-block::                              |.. code-block::                               |
      |   :caption: /main/zero_topo/                |   :caption: /main/zero_topo/                 |
      |                                             |                                              |
      |   gnuplot plot_script_restest.p             |   python3 plot_script_restest.py             |
      +---------------------------------------------+----------------------------------------------+

.. collapse:: How to reproduce the results and figures for synthetic topography

   Please note basic setup in :ref:`installation`.
   To avoid redundancy, in this section we outline one setup for each of tests done, trusting the described differences in each run to be well explained in the text above.

   1. In ``MTE.py``, modify benchmark attribution to ``5``, and make sure the right setup is used:

      .. code-block:: python
         :caption: /main/MTE.py
         :linenos:
         :lineno-start: 27
         :emphasize-lines: 1,5,7,13

         benchmark = '5'
         compute_vi = False

         ## ONLY BENCHMARK = -1 (DEM) & BENCHMARK = 5 (FLANKSIM) ##
         flat_bottom = True  # If True, a flat bottom is generated at the lower surface of the domain, please see documentation.
                             # As the specific setup of this feature is different for the flank simulations and the DEM test.
         remove_zerotopo = False  # Setup run 2 times: first time, zero topography setup: xy observation points same a path
                                 # but zerotopo domain shifted to average height DEM.
                                 # Second time, full domain with topography ("regular" run).
                                 # From which the zerotopo values are subtracted before writing to regular output files.

         ## ONLY BENCHMARK = 5 (FLANKSIM) ##
         subbench = 'south'  # Either 'south', 'east', 'north', 'west', choosing flank shifts domain features, and observation paths.


   2. Run setups & move files

      +----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+
      |.. code-block:: python            |.. code-block:: python            |.. code-block:: python            |.. code-block:: python            |.. code-block:: python            |.. code-block:: python            |.. code-block:: python            |
      |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |   :caption: /main/MTE.py         |
      |   :linenos:                      |   :linenos:                      |   :linenos:                      |   :linenos:                      |   :linenos:                      |   :linenos:                      |   :linenos:                      |
      |   :lineno-start: 237             |   :lineno-start: 237             |   :lineno-start: 237             |   :lineno-start: 237             |   :lineno-start: 237             |   :lineno-start: 237             |   :lineno-start: 237             |
      |   :emphasize-lines: 2,3,4,5,6,7  |   :emphasize-lines: 4            |   :emphasize-lines: 4,5,6        |   :emphasize-lines: 5,6          |   :emphasize-lines: 5,6          |   :emphasize-lines: 7            |   :emphasize-lines: 4,5,6,7      |
      |                                  |                                  |                                  |                                  |                                  |                                  |                                  |
      |   if benchmark == '5':           |   if benchmark == '5':           |   if benchmark == '5':           |   if benchmark == '5':           |   if benchmark == '5':           |   if benchmark == '5':           |   if benchmark == '5':           |
      |      Lx = 50                     |      Lx = 50                     |      Lx = 50                     |      Lx = 50                     |      Lx = 50                     |      Lx = 50                     |      Lx = 50                     |
      |      Ly = 50                     |      Ly = 50                     |      Ly = 50                     |      Ly = 50                     |      Ly = 50                     |      Ly = 50                     |      Ly = 50                     |
      |      Lz = 120                    |      Lz = 240                    |      Lz = 120                    |      Lz = 120                    |      Lz = 120                    |      Lz = 120                    |      Lz = 240                    |
      |      nelx = 10                   |      nelx = 10                   |      nelx = 25                   |      nelx = 50                   |      nelx = 75                   |      nelx = 75                   |      nelx = 75                   |
      |      nely = 10                   |      nely = 10                   |      nely = 25                   |      nely = 50                   |      nely = 75                   |      nely = 75                   |      nely = 75                   |
      |      nelz = 10                   |      nelz = 10                   |      nelz = 10                   |      nelz = 10                   |      nelz = 10                   |      nelz = 100                  |      nelz = 10                   |
      +----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+----------------------------------+

      .. code-block::
            :caption: /main/

            python3 -u MTE.py | tee log.txt

      +--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+
      |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |.. code-block::                                                                                                                 |
      |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |   :caption: /main/                                                                                                             |
      |                                                                                                                                |                                                                                                                                |                                                                                                                                |                                                                                                                                |                                                                                                                                |                                                                                                                                |                                                                                                                                |
      |   mkdir flanksim_parameters/south/restest/10_10_10 && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/10_10_10      |   mkdir flanksim_parameters/south/restest/10_10_10_DD && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/10_10_10_DD|   mkdir flanksim_parameters/south/restest/25_25_10 && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/25_25_10      |   mkdir flanksim_parameters/south/restest/50_50_10 && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/50_50_10      |   mkdir flanksim_parameters/south/restest/75_75_10 && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/75_75_10      |   mkdir flanksim_parameters/south/restest/75_75_100 && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/75_75_100    |   mkdir flanksim_parameters/south/restest/75_75_10_DD && mv log.txt *.vtu *.ascii flanksim_parameters/south/restest/75_75_10_DD|
      +--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------+


   3. Go to directory & plot to visualize

      .. code-block::
         :caption: /main/

         cd flanksim_parameters/

      +---------------------------------------------+----------------------------------------------+
      |.. code-block::                              |.. code-block::                               |
      |   :caption: /main/flanksim_parameters/      |   :caption: /main/flanksim_parameters/       |
      |                                             |                                              |
      |   gnuplot plot_script_restest.p             |   python3 plot_script_restest.py             |
      +---------------------------------------------+----------------------------------------------+




Size
----
| The size experiments will commence with a more compact domain and progressively expand it until the computed magnetic field at a point above the domain center stabilizes. The outcomes of changes in both the depth extent (z-direction) and spatial extent (xy-direction) will be analyzed, maintaining element resolution consistent with the previously established threshold at observation points along a path 1 meter above the surface.
|
| However, upon adapting domain depth, a complication surfaces: the exact nature of the magnetization in the underlying flows and deeper is unknown. Nonetheless, we continue to assume a uniform magnetization. This assumption now expands deeper, eventually stretching to the full pile of volcanic flows of Mount Etna. To validate this assumption, we refer to the geomagnetic history of Mount Etna. The last reversal of Earth's magnetic field was dated around :math:`\sim795` ka ago :cite:`Singer19` and the first volcanic activity of Mount Etna was dated around :math:`\sim500` ka ago :cite:`Branca08`.
| Therefore, no reversals are anticipated within the accumulated layers, allowing us to extend the depth for experimental purposes without restrictions. Nonetheless, as the directly underlying flow is deemed to exert the most substantial influence, expanding the depth beyond a singular flow might be redundant. The thickness of the flows underneath the field sites mentioned in :cite:`Meyer23` fluctuate between 5-15 meter :cite:`Andro05, Mur00`.
| Consequently, our tests explore domain depth ranging from 10 to 140 meter. When it comes to spatial extent, no additional consideration are necessary, and so our experiments span a spatial extent from 50 to 1000 meters.


Results and analysis
^^^^^^^^^^^^^^^^^^^^
.. _zt_low:
.. figure:: figures/zt_low.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the size experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.

| In the investigations presented in :numref:`zt_low`, spatial extents below 250x250 meters prominently display edge effects. This is particularly evident for the :math:`B_y` component, which should ideally measure zero in the absence of topography or declination in magnetization. A uniform value across the observation path indicates the absence of edge effects, whereas variable values correlate with proximity to the domain edge.

.. _zt_high_dif:
.. figure:: figures/zt_high_dif.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the size experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.

| Our data reveals a nuanced relationship between the depth extent of the domain and the anomaly's intensity, as evident in both :numref:`zt_low` and :numref:`zt_high_dif`. Notably, for components :math:`B_x` and :math:`B_z`, magnitude increases with depth in a non-linear fashion. An initial increase in depth (10 to 600 meters) yields a significant change in component values, but a subsequent increase from 600 to 1200 meters sees marginal differences. This relationship also depends on spatial extent. For instance, 500x500x40 and 250x250x20 meter configurations produce identical :math:`B_x` and :math:`B_z` values. Observations unveil three distinct patterns, see :numref:`zt_high_dif`:

1. Identical values arise when both depth and spatial extent increase equivalently (e.g., 250x250x20 and 500x500x40 meters).
2. Increasing spatial extent alone reduces the magnitude proportionally (e.g., 250x250x20 and 500x500x20 meters).
3. Increasing depth alone enhances the magnitude proportionally (e.g., 250x250x20 and 250x250x40 meters or 500x500x20 and 500x500x40 meters).

| It is important to highlight that the inclination values are consistent across different setups, given that the modulating factor for both :math:`B_x` and :math:`B_z` remains identical.

.. _extest_comp_mp_high:
.. figure:: figures/extest_comp_mp_high.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the depth experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot

| :numref:`extest_comp_mp_high` display the outcomes from testing the domain size constraints on a simulation with topography, and displays similar trends with respect to required spatial extent and relationship between spatial dimension and magnitude of components.


Verification
""""""""""""
.. _zt_sivi:
.. figure:: figures/zt_sivi.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the depth experiments. The spatial extent of the domain is 50x50 meter. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.

| We adopted the 3D Gauss-Legendre quadrature rules to numerically determine the volume integral (see :eq:`eq.10_2`). This methodology served as a reference due to the absence of published benchmarks. Remarkably, our essentially analytical solutions align closely with the numerical approximations, see :numref:`zt_sivi` which suggests that the observed trends aren't computational but more theoretical in nature.


Challenges in Setup Optimization
""""""""""""""""""""""""""""""""
| Determining the optimal setup poses challenges. While increasing domain size might intuitively stabilize computed values, :numref:`extest_comp_mp_high`, :numref:`zt_low` and :numref:`zt_high_dif` contradict this presumption. While consistent depth expansion appears to eventually plateau the results, increasing depth continues to influence the magnitudes of the :math:`B_x` and :math:`B_z` components, as illustrated in various depth configurations with a spatial layout of 250x250 in :numref:`zt_low`. Moreover, when comparing deeper configurations like 500x500x1800 with 500x500x20 meters in :numref:`zt_low`, a pronounced amplification of edge effects for the :math:`B_y` component is evident. This trend aligns with recommendations from the foundational study by :cite:`Bott63`, suggesting that optimal results emerge when the depth is substantially less than the areal extent.
|
| Nevertheless, this observation does not offer clarity in distinguishing between configurations of shallower depths but varied spatial dimensions, such as 250x250x10, 250x250x20, 500x500x20, and 500x500x40 meters. Still, by examining :numref:`extest_comp_mp_high`, it becomes apparent that magnitude differences for these setups are minimal when juxtaposed with anomalies caused by domain topography.

.. _topo_zt_fb_comp:
.. figure:: figures/topo_zt_fb_comp.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the depth experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.

.. _topo_zt_fb_sloped:
.. figure:: figures/topo_zt_fb_sloped.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the depth experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.

| More importantly, when computations at the same observation points for a zero topography solution with corresponding dimensions are subtracted from the topographic simulation values, the discrepancies nearly converge into a single solution, see :numref:`topo_zt_fb_comp`. The residual minor fluctuations in the :math:`B_x` components across domains of different sizes are likely due to the incline of the topography simulation. In consideration that in this approach we merely subtract essentially a box from the southern slope simulation, which ascends northward. In :numref:`topo_zt_fb_sloped` we see that indeed removing a sloped box from the computed values does lead to all different domain solution to collapse into one single solution, however, we have now also (succesfully) removed the effect the sloped flank had on the output. This is not beneficial, as most lava fields are deposited on flanks of a volcanic pile. Therefore, and again highlighting that these anomalies are small compared to the topographic anomalies we are studying, we suggest for more complex domain configuration to subtract a zero topography solution from the outcome to abolish any influence of domain size on the results. However, we do also suggest future investigation to judiciously consider both depth and spatial extent on the domain.

| This study's focal point is the influence of topography on magnetic field readings above a flow, thus, this subtraction technique is adequate for alleviating complications linked to domain size and the magnitude of the resultant anomaly. A key takeaway is that maintaining **a spatial size above or equal to 250x250 meter**, where the depth is considerably less than the spatial dimension, is crucial.

Reproduce
^^^^^^^^^

Bottom boundary
---------------
| One last issue to contemplate, is the shape of the bottom of the mesh. The topography on the bottom can be simulated in two ways:

1. use the same topography as the top surface
2. produce a flat bottom.

.. _topo_zt_fb_sb:
.. figure:: figures/topo_zt_fb_sb.png
   :scale: 70%

   Three subplots containing the components of the computed magnetic field **B** for the depth experiments. The numbers in the key relate to the length of each side of the domain (Lx_Ly_Lz). Please note, the y-axis varies between each subplot.


.. _sb_fb:
.. figure:: figures/sb_fb_250_250_20.png
   :class: with-border

   The resulting mesh using either the same topography as the top surface (on the right) or a flat bottom (on the left) for the setup as outlined in :ref:`flank simulations <flanksim>`.

| See :numref:`sb_fb` for the visualization of the different options.

| As our computational solution is a surface integral and the interior contributions should cancel out, we can understand the possible repercussion of this predicament. Neither is an accurate representation of reality and from theory we know the effect could be significant. Therefore, the differences need to be investigated and both methods will be used and compared.

| It should be noted that the flat bottom setup of the :ref:`flank simulations <flanksim>` is different from the :doc:`etna`. For :ref:`flank simulations <flanksim>` the input value for depth of the domain is added in the middle of the domain (exactly below the observation path) to the topography simulated by the slope and sine wave (see :py:func:`support.topography`). In this fashion, when testing using a flat bottom, the chosen depth value actually relates to the depth value underneath the path regardless of other parameters of the domain (desirable for parameter testing). However, as the slope and wave topography is also anchored in the middle of the domain, it is possible to create a setup where the base of the flat bottom intersects with the surface topography. [#]_ Even though this intersection happens at a significant distance from the path, the results are not tested or verified and this situation should be avoided.
| To avoid this situation for the DEM based topography setups, the depth of the domain is added to the lowest value of the surface topography from the DEM. However, this does result in varying depth extent underneath the path depending on the spatial extent of the section of the DEM used. To still subtract a zero topography solution this requires the depth of the zero topography domain to be modified to still accurately represent the domain depth underneath the measurement path.

Results
^^^^^^^

Reproduce
^^^^^^^^^

.. rubric:: Footnotes

.. [#] An example: run base setup for flank simulations with domain size of 250x250x10m.
